# V2EX TUI - Improvement Roadmap

本文档跟踪 V2EX TUI 项目的改进计划和任务。按优先级和类别组织。

## 🚨 高优先级 (急需改进)

### 代码结构与可维护性
| 任务 | 描述 | 状态 | 位置/影响 |
|------|------|------|-----------|
| **拆分巨大的 main.rs** | 将 1756 行的 `main.rs` 拆分为模块化结构 | 待办 | `src/main.rs` (整个文件) |
| **简化 App 状态** | App 结构体有 ~75 个字段，分组为子结构体 | 待办 | `src/main.rs:40-76` |
| **抽象事件处理** | 消除重复的 `if app.view == View::NodeSelect && app.is_node_completion_mode` 检查 | 待办 | `src/main.rs:718-800` (多处) |

### 测试与质量
| 任务 | 描述 | 状态 | 位置/影响 |
|------|------|------|-----------|
| **添加单元测试** | 目前为零单元测试，添加 `#[test]` 函数 | 待办 | 整个项目 |
| **设置持续集成** | 添加 GitHub Actions 运行 `cargo test`、`cargo clippy`、`cargo fmt --check` | 待办 | `.github/workflows/` |

## ⚡ 中优先级 (重要改进)

### 错误处理与用户体验
| 任务 | 描述 | 状态 | 位置/影响 |
|------|------|------|-----------|
| **统一 API 错误处理** | `request()` 和 `request_with_body()` 逻辑重复，统一错误处理 | 待办 | `src/api.rs:231-300`, `258-312` |
| **改进令牌加载错误** | 提供更清晰的令牌文件缺失/错误信息 | 待办 | `src/api.rs:216-222` |

### 性能优化
| 任务 | 描述 | 状态 | 位置/影响 |
|------|------|------|-----------|
| **API 响应缓存** | 添加缓存机制减少重复请求 | 待办 | `src/api.rs` 的 `get_*` 方法 |
| **优化节点模糊匹配** | 1333 个节点的实时匹配可能影响响应速度 | 待办 | `src/main.rs` 节点选择逻辑 |

## 🔧 低优先级 (增强功能)

### 配置与自定义
| 任务 | 描述 | 状态 | 位置/影响 |
|------|------|------|-----------|
| **主题和快捷键配置** | 支持 `~/.config/v2ex/config.toml` 自定义 | 待办 | `src/ui.rs:10-33` (Theme) |
| **可配置收藏节点** | 允许用户自定义 1-9 快捷键对应的节点 | 待办 | `src/main.rs:80-94` |

### 文档与代码质量
| 任务 | 描述 | 状态 | 位置/影响 |
|------|------|------|-----------|
| **添加代码文档** | 为复杂函数添加 `///` 文档注释 | 待办 | `src/main.rs` 大型函数 |
| **更新 README 功能列表** | 反映实际可用功能，移除未实现的 `g`/`G` | 待办 | `README.md:62-63` |
| **检查依赖更新** | 更新 `crossterm`、`ratatui`、`reqwest` 等依赖 | 待办 | `Cargo.toml:9-22` |

## 🚀 功能增强 (未来版本)

### 新功能建议
| 任务 | 描述 | 状态 | 影响范围 |
|------|------|------|----------|
| **搜索功能** | 添加 `/` 快捷键搜索话题标题 | 待办 | 新视图、API 调用 |
| **书签/历史记录** | 保存感兴趣的话题到本地文件 | 待办 | 新存储模块 |
| **通知管理** | 实现 `delete_notification()` 功能 | 待办 | `src/api.rs:326-333` |
| **节点详情查看** | 使用 `get_node()` 显示节点信息 | 待办 | `src/api.rs:337-342` |

## 📋 任务状态说明

- **待办**：尚未开始
- **进行中**：正在实施
- **完成**：已完成并测试
- **阻塞**：依赖其他任务

## 🎯 实施顺序建议

1. **立即开始**：拆分 `main.rs`、添加单元测试
2. **短期计划**：统一错误处理、优化事件处理
3. **中期计划**：配置系统、性能优化
4. **长期计划**：新功能、更好的用户体验

## 📝 贡献指南

1. 选择要处理的任务，更新状态为"进行中"
2. 实现时遵循项目代码风格（参考 `AGENTS.md`）
3. 完成后运行 `cargo fmt`、`cargo clippy -- -D warnings`、`cargo test`
4. 更新状态为"完成"，添加提交信息
5. 考虑添加相关测试覆盖

## 🔗 相关资源

- [AGENTS.md](./AGENTS.md) - 开发指南
- [V2EX API 2.0 文档](https://www.v2ex.com/help/api) - API 参考
- [现有代码结构](./src/) - 当前实现

---
*最后更新: 2025-02-07*